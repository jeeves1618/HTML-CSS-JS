<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compute</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link type="text/css" rel="stylesheet" href="css/topic.css" />
  </head>
  <body>
    <header id="main-header">
      <a href="index.html" id="logo">Azure</a>
      <nav>
        <ul>
          <li><a href="">Books</a></li>
          <li><a href="">Courses</a></li>
        </ul>
      </nav>
      <a href="#side-drawer" class="menu-btn"
        ><span></span><span></span><span></span
      ></a>
    </header>
    <aside id="side-drawer">
      <header id="sub-header">
        <a href="refresher.html" id="sublogo">Compute</a>
        <a href="#" class="menu-btn"><span></span><span></span><span></span></a>
      </header>
      <nav>
        <ul>
          <li><a href="">Books</a></li>
          <li><a href="">Courses</a></li>
        </ul>
      </nav>
    </aside>
    <main>
      <h1>Compute</h1>
      <section id="latest-products">
        <ul>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">Azure Compute</h2>
                <p>
                  Compute is a set of cloud services for hosting and running our
                  applications. It is with the compute services that we upload
                  our code and run it. It offers various levels and controls and
                  flexibility.
                </p>
                <p>There are four types of compute services.</p>
                <ol>
                  <li>1. Virtual Machines</li>
                  <li>2. App Services</li>
                  <li>3. Azure Kubernetes Service (AKS)</li>
                  <li>4. Azure Functions</li>
                </ol>
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">Virtual Machines (VM)</h2>
                <p>
                  A virtual (=not real) server is a program running a physical
                  (=real) server. It allows creation of new servers extremely
                  fast because we are not provisioning any new hardware
                  resources. It is created on the existing resources of the
                  physical server. From the user's perspective, it is regular
                  server that you can connect through SSH etc..
                </p>
                <p>
                  An Azure virtual machine is an unmanaged service. That is
                  because Azure doesn't manage what is happening inside the
                  virtual machine. Azure doesn't care about the kind of OS,
                  presence of anti virus etc. They are our responsibilities and
                  that makes VMs a classic Infrastructure as a Service.
                </p>
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">VM Architecture</h2>
                <img src="./img/Architecture.jpg" />
                <p>
                  The pysical layer is managed by Azure with no control or
                  access to us, whereas the virtual layer will be managed by us
                  with complete control and access. Please note that here Azure
                  provides just the Infrastructure and this set up is a classic
                  Infrastructure as a Service.
                </p>
              </div>
            </article>
          </li>

          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">Creating VMs</h2>
                <p>
                  We can create a VM in Azure by selecting the location, image
                  (OS and other pre installed softwares) and the compute size.
                </p>
                <p>
                  Before creating a VM, we can check the pricing
                  <a
                    href="https://azure.microsoft.com/en-in/pricing/calculator/"
                    target="_blank"
                    >here</a
                  >. Once we have selected the region, OS and instance, search
                  for Virtual Machine in the portal. Click on the add button to
                  fill up the form for provisioning the VM. If we select a
                  Windows VM, we will be asked to create an administrator
                  account within the VM.
                </p>
                <p>
                  Once you submit the form, Azure will start a deployment task
                  to create the VM. And you will see four more VMs will be
                  created. These addional resources are created for network
                  interfaces, security groups, IP addresses and virtual
                  networks. Once the VM is created, you can connect to that VM
                  through SSH, RDP or Bastion. Usually we use RDP for Windows
                  and SSH for Linux.
                </p>
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">Connecting to VMs</h2>
                <p>
                  If we create a VM with Windows VM, we can connect using RDP.
                  We will have to download the RDP file. Executing the RDP file
                  will give the option to connect. Clicking on connect will ask
                  for credentials. Provide the user name as
                  ./AzureAccountUserName. This will connect you to a Windows
                  machine where you can install software, browse website etc.
                </p>
                <p>
                  We can close the virtual machine if we are not working on it.
                  But, closing it will not stop the server. We can stop the
                  server through the portal. But, stopping the server will not
                  stop the payments completely because of implicit usage of
                  resources. So, if you want to save money, please go ahead and
                  delete the resource group completely.
                </p>
                <p>
                  The real cost of the VM includes the cost of VM, the cost of
                  <a
                    href="https://learn.microsoft.com/en-us/azure/virtual-machines/managed-disks-overview"
                    target="_blank"
                    >disk</a
                  >, the cost of the IP through which the VM is exposed and the
                  cost of the storage where the image of the VM is stored. Here
                  is the cost distribution for a small VM.
                </p>
                <img src="./img/VMCost.jpg" />
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">Reducing Cost</h2>
                <p>
                  If you want to reduce the cost during the development phase
                  without deleting and recreating the resource group, you can
                  opt for <strong>Auto Shutdown</strong> to automatically shut
                  down the machine when not needed. The storage and the IP costs
                  will still be incurred. Still you can save more than 50% of VM
                  cost.
                </p>
                <p>
                  Upfront payment using <strong>Reserved Instances</strong> (for
                  1 or 3 years) will help reducing the cost. Another way of
                  reducing cost is to use <strong>Spot Instances</strong>. We
                  can utilize the unused capacity in Azure with the risk of
                  getting evicted any moment. For non critical and non
                  continuous dev applications, spot instances can provide upto
                  90% discount. Your discount will be based on the eviction type
                  and policy choices.
                </p>
                <p>
                  Fourth way of reducing cost is
                  <strong>Disk Optimization.</strong> For many VMs, the default
                  disk is Premium SSD, which is the most expensive option. If
                  our app is not very data intensive, we can go for standard
                  SSD.
                </p>
                <p>
                  Always select the right VMs. The CPU shouldn't be under
                  utilized. Also, we should select Linux over Windows whenever
                  possible. For non prod applications, check the price in
                  cheaper regions since latency is not a challenge.
                </p>
                <p>
                  Focussing on cost will have a trade off on the availability of
                  VMs. We will discuss availability in the next section.
                </p>
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">Availability</h2>
                <p>
                  <a
                    href="https://azure.microsoft.com/en-us/support/legal/sla/virtual-machines/v1_9/"
                    target="_blank"
                    >The SLA</a
                  >
                  for virtual machines is dependent on the number of instances
                  and the choice of the disk. As you can see in the link, there
                  are five SLAs.
                </p>
                <p>
                  We have to understand four important availability concepts in
                  Azure in order build high availability applications. They are
                  fault domain, update domain, availability set and availability
                  zone. Leveraging these concepts will help in increasing
                  availability without addional cost.
                </p>
                <p>
                  A fault domain is the group of physical hardware that share a
                  common power source, network switch etc. and can go down as
                  whole if there are power or network interruptions. An update
                  domain is the Logical group of physical hardware that can
                  undergo maintenance and be rebooted at the same time.
                  Maintenance is done by Azure at its own discretion.
                </p>
                <p>
                  So, if all our VMs are in the same fault domain, they can go
                  down at the same time. If all our VMs are in the same update
                  domain they will reboot at the same time during maintenance.
                  The trick is to keep them spread across fault and update
                  domains. That is where the availability set comes into
                  picture.
                </p>
                <p>
                  An availability set is the arrangement of our VMs across fault
                  domains and update domains for maximum availability. One
                  availability set can contain up to 3 Fault Domains and up to
                  20 Update Domains. All domains are in the same datacenter (i.e
                  same building).
                </p>
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">Availability Set</h2>
                <p>
                  Fault domains and update domains can be specified as below.
                </p>
                <img src="./img/avail-set-create.jpg" />
                <p>
                  Dual VMs deployed in a 2 X 3 availability set will be hosted
                  by Azure as below.
                </p>
                <img src="./img/avail-set.jpg" />
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">Availability Zone</h2>
                <p>
                  Availability zone is a separate building, containing an
                  autonomous data center, within an availability region. The
                  different zones within a region functions as fault and update
                  domains. It is configured in a way that even when one
                  autonomous datacenter is down, we can ensure availability
                  through other. This arrangement has the highest SLA. > The
                  availability set or zone can be selected during the creation
                  of a VM.
                </p>
                <img src="./img/avail-options.jpg" />
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">ARM Template</h2>
                <p>
                  ARM is Azure Resource Manager Template. ARM templates are a
                  form of infrastructure as code, a concept where you define the
                  infrastructure that needs to be deployed. ARM templates use
                  declarative syntax, meaning you define the resources for Azure
                  to deploy without specifying how the resources are created.
                </p>
                <p>
                  <a
                    href="https://learn.microsoft.com/bs-latn-ba/azure/azure-resource-manager/templates/"
                    target="_blank"
                    >Azure Resource Manager templates</a
                  >
                  are JavaScript Object Notation (JSON) files that define the
                  infrastructure and configuration for your project. You can
                  download a template during creation by clicking on the
                  download link below after the review, but before the
                  deployment of resources.
                </p>
                <img src="./img/ARS-Template-Link.jpg" />
                <p>
                  More details on ARM template downloads are available
                  <a
                    href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/templates/export-template-portal"
                    >here.</a
                  >
                  The ARM Template will have parameters.json and the
                  template.json files. The parameters json will have the values
                  for the resources defined in the template json. The downloaded
                  files can be updated through visual code. Uploading the update
                  templates isn't straight forward and it is explained very well
                  in Memi Levi's lecture 50 on Azure.
                </p>
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">VM Scale Set</h2>
                <p>
                  To provide redundancy and improved performance, applications
                  are typically distributed across multiple instances. Customers
                  may access your application through a load balancer that
                  distributes requests to one of the application instances. If
                  you need to perform maintenance or update an application
                  instance, your customers must be distributed to another
                  available application instance. To keep up with extra customer
                  demand, you may need to increase the number of application
                  instances that run your application.
                </p>
                <p>
                  Azure Virtual Machine Scale Sets let you create and manage a
                  group of load balanced VMs. The number of VM instances can
                  automatically increase or decrease in response to demand or a
                  defined schedule.
                </p>
                <p>
                  When you have many VMs that run your application, it's
                  important to maintain a consistent configuration across your
                  environment. For reliable performance of your application, the
                  VM size, disk configuration, and application installs should
                  match across all VMs. With scale sets, all VM instances are
                  created from the same base OS image and configuration.
                </p>
              </div>
            </article>
          </li>
          <li class="topic-item">
            <article>
              <div class="topic-item-content">
                <h2 class="content">Azure IMDS</h2>
                <p>
                  <a
                    href="https://learn.microsoft.com/en-us/azure/virtual-machines/windows/instance-metadata-service?tabs=windows"
                    target="_blank"
                    >Azure Instance Metadata Service (IMDS)</a
                  >
                  is the REST API accessible only from the VM. It provides lot
                  of information about the VM. With the scaleset configured,
                  this REST service gets notification about the upcoming
                  eviction of a VM.
                </p>
                <p>
                  The Instance Metadata Service is only accessible from within a
                  running virtual machine instance on a non-routable IP address.
                  VMs are limited to interacting with metadata/ functionality
                  that pertains to themselves. The API is HTTP only and never
                  leaves the host. In order to ensure that requests are directly
                  intended for IMDS and prevent unintended or unwanted
                  redirection of requests, requests: Must contain the header
                  Metadata: true Must not contain an X-Forwarded-For header Any
                  request that does not meet both of these requirements will be
                  rejected by the service.
                </p>
                <p>
                  IMDS can be accessed through 
                </p>
              </div>
            </article>
          </li>
        </ul>
      </section>
    </main>

    <footer></footer>
  </body>
</html>
